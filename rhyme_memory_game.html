<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concéntrese de Rimas</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuración de Tailwind para usar la fuente Inter y colores de juego -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Colores inspirados en el arcoíris y la marca (Rojo, Cian, Amarillo)
                        'brand-primary': '#ef4444', // Rojo vibrante para acción
                        'card-back-color': '#22d3ee', // Cian brillante para el dorso
                        'brand-success': '#10b981', // Verde para éxito
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Estilos de la tarjeta para la animación de volteo */
        .card-inner {
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }

        .card-container.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: pointer;
            user-select: none;
        }

        .card-front {
            background-color: white; /* Fondo blanco para legibilidad */
            border: 4px solid var(--card-color); /* Borde con color de la tarjeta */
            transform: rotateY(180deg);
            color: var(--card-color); /* Color del texto con color de la tarjeta */
        }

           .card-back {
            background-color: var(--card-back-color, #22d3ee); /* Cian brillante */
            border: 4px solid #0891b2; /* Borde más oscuro */
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
        }

        /* Animación para el error (mismatch) */
        .mismatch {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Estilo para el mensaje de victoria */
        #win-message {
            z-index: 50;
        }
    </style>
</head>
<!-- Fondo muy claro con un toque de color -->
<body class="bg-indigo-50 font-sans min-h-screen p-4 flex flex-col items-center justify-center">

    <div class="max-w-xl w-full mx-auto space-y-6">

        <header class="text-center p-4 bg-white rounded-xl shadow-lg">
            <h1 class="text-3xl font-extrabold text-brand-primary flex items-center justify-center">
                <span class="text-5xl mr-2">🌈</span> Juego de Rimas
            </h1>
            <p class="text-gray-600 mt-1 text-sm">Encuentra las tarjetas que riman. ¡A concentrarse!</p>
        </header>

        <!-- Área de Estado del Juego -->
        <div class="flex justify-between items-center p-3 bg-white rounded-xl shadow-md">
            <div class="text-lg font-semibold text-gray-700">
                Nivel: <span id="current-level" class="text-brand-primary">1</span>/5
            </div>
            <div class="text-lg font-semibold text-gray-700">
                Movimientos: <span id="moves-count" class="text-brand-primary">0</span>
            </div>
            <!-- Botón de Reiniciar con el color Rojo vibrante -->
            <button id="restart-button" onclick="resetGame()"
                    class="px-4 py-2 bg-brand-primary hover:bg-red-600 text-white font-bold rounded-lg shadow-md transition duration-200 transform hover:scale-105 active:scale-95">
                Reiniciar
            </button>
        </div>

        <!-- Mensaje de Victoria (Oculto inicialmente) -->
        <div id="win-message" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
            <div class="bg-white p-8 rounded-xl shadow-2xl text-center border-4 border-yellow-500 max-w-sm w-full">
                <p class="text-6xl mb-4" id="win-emoji">🥳</p>
                <h2 class="text-3xl font-bold text-yellow-600 mb-3" id="win-title">¡Nivel Completado!</h2>
                <p class="text-xl text-gray-700 mb-5" id="win-text">Has encontrado todas las rimas en <span id="final-moves" class="font-extrabold text-yellow-600"></span> movimientos.</p>
                
                <!-- Botón de acción (Continuar o Jugar de Nuevo) -->
                <button id="action-button" onclick="goToNextLevel()" class="px-6 py-3 bg-brand-primary hover:bg-red-600 text-white font-bold rounded-full shadow-lg transition duration-200 transform hover:scale-105">
                    Siguiente Nivel
                </button>
            </div>
        </div>


        <!-- Tablero del Juego (Grid 4x4) -->
        <div id="game-board" class="grid grid-cols-4 gap-3 md:gap-4 p-3 bg-white rounded-xl shadow-inner">
            <!-- Las tarjetas se insertarán aquí por JavaScript -->
        </div>

    </div>

    <script>
        // --- DATA DE LAS TARJETAS POR NIVEL (5 NIVELES, 8 PARES C/U) ---
        const levelsCardData = [
            // Nivel 1: Rimas básicas
            [
                { id: 1, word: 'LUNA', rhymeMatchId: 2, emoji: '🌙', color: '#1e40af' }, 
                { id: 2, word: 'CUNA', rhymeMatchId: 1, emoji: '🛏️', color: '#065f46' }, 
                { id: 3, word: 'ESTRELLA', rhymeMatchId: 4, emoji: '⭐', color: '#f59e0b' }, 
                { id: 4, word: 'BOTELLA', rhymeMatchId: 3, emoji: '🍾', color: '#991b1f' }, 
                { id: 5, word: 'RATÓN', rhymeMatchId: 6, emoji: '🐭', color: '#4f46e5' }, 
                { id: 6, word: 'BOTÓN', rhymeMatchId: 5, emoji: '🔘', color: '#65a30d' }, 
                { id: 7, word: 'PATO', rhymeMatchId: 8, emoji: '🦆', color: '#be123c' }, 
                { id: 8, word: 'GATO', rhymeMatchId: 7, emoji: '🐈', color: '#a855f7' }, 
                { id: 9, word: 'CASA', rhymeMatchId: 10, emoji: '🏠', color: '#059669' }, 
                { id: 10, word: 'TAZA', rhymeMatchId: 9, emoji: '☕', color: '#f97316' }, 
                { id: 11, word: 'VELA', rhymeMatchId: 12, emoji: '🕯️', color: '#0891b2' }, 
                { id: 12, word: 'ESCUELA', rhymeMatchId: 11, emoji: '🏫', color: '#db2777' }, 
                { id: 13, word: 'PIÑA', rhymeMatchId: 14, emoji: '🍍', color: '#84cc16' }, 
                { id: 14, word: 'NIÑA', rhymeMatchId: 13, emoji: '👧', color: '#fbbf24' }, 
                { id: 15, word: 'SOL', rhymeMatchId: 16, emoji: '☀️', color: '#ca8a04' }, 
                { id: 16, word: 'GIRASOL', rhymeMatchId: 15, emoji: '🌻', color: '#7e22ce' }, 
            ],
            // Nivel 2
            [
                { id: 1, word: 'CAMIÓN', rhymeMatchId: 2, emoji: '🚚', color: '#ef4444' }, 
                { id: 2, word: 'LIMÓN', rhymeMatchId: 1, emoji: '🍋', color: '#a3e635' }, 
                { id: 3, word: 'PERRO', rhymeMatchId: 4, emoji: '🐕', color: '#44403c' }, 
                { id: 4, word: 'CERRO', rhymeMatchId: 3, emoji: '⛰️', color: '#22c3e6' }, 
                { id: 5, word: 'QUESO', rhymeMatchId: 6, emoji: '🧀', color: '#fcd34d' }, 
                { id: 6, word: 'HUESO', rhymeMatchId: 5, emoji: '🦴', color: '#f97316' }, 
                { id: 7, word: 'FLOR', rhymeMatchId: 8, emoji: '🌸', color: '#ec4899' }, 
                { id: 8, word: 'AMOR', rhymeMatchId: 7, emoji: '❤️', color: '#be123c' }, 
                { id: 9, word: 'ANILLO', rhymeMatchId: 10, emoji: '💍', color: '#6366f1' }, 
                { id: 10, word: 'MARTILLO', rhymeMatchId: 9, emoji: '🔨', color: '#4ade80' }, 
                { id: 11, word: 'NARIZ', rhymeMatchId: 12, emoji: '👃', color: '#9d174d' }, 
                { id: 12, word: 'RAÍZ', rhymeMatchId: 11, emoji: '🌳', color: '#059669' }, 
                { id: 13, word: 'BALÓN', rhymeMatchId: 14, emoji: '⚽', color: '#0f766e' }, 
                { id: 14, word: 'MELÓN', rhymeMatchId: 13, emoji: '🍈', color: '#7c3aed' }, 
                { id: 15, word: 'PINCEL', rhymeMatchId: 16, emoji: '🖌️', color: '#c026d3' }, 
                { id: 16, word: 'CARAMEL', rhymeMatchId: 15, emoji: '🍬', color: '#f43f5e' }, 
            ],
            // Nivel 3
            [
                { id: 1, word: 'COCHE', rhymeMatchId: 2, emoji: '🚗', color: '#0d9488' }, 
                { id: 2, word: 'NOCHE', rhymeMatchId: 1, emoji: '🌃', color: '#3730a3' }, 
                { id: 3, word: 'VENTANA', rhymeMatchId: 4, emoji: '🪟', color: '#16a34a' }, 
                { id: 4, word: 'MANZANA', rhymeMatchId: 3, emoji: '🍎', color: '#dc2626' }, 
                { id: 5, word: 'CABALLO', rhymeMatchId: 6, emoji: '🐴', color: '#7c2d12' }, 
                { id: 6, word: 'GALLO', rhymeMatchId: 5, emoji: '🐔', color: '#fde047' }, 
                { id: 7, word: 'CORAZÓN', rhymeMatchId: 8, emoji: '💖', color: '#f472b6' }, 
                { id: 8, word: 'SAZÓN', rhymeMatchId: 7, emoji: '🧂', color: '#6b7280' }, 
                { id: 9, word: 'MONO', rhymeMatchId: 10, emoji: '🐒', color: '#4c0519' }, 
                { id: 10, word: 'TRONO', rhymeMatchId: 9, emoji: '👑', color: '#ca8a04' }, 
                { id: 11, word: 'JABÓN', rhymeMatchId: 12, emoji: '🧼', color: '#0ea5e9' }, 
                { id: 12, word: 'PATÓN', rhymeMatchId: 11, emoji: '🦶', color: '#22c3e6' }, 
                { id: 13, word: 'MANO', rhymeMatchId: 14, emoji: '✋', color: '#f97316' }, 
                { id: 14, word: 'HERMANO', rhymeMatchId: 13, emoji: '🧑‍🤝‍🧑', color: '#fbbf24' }, 
                { id: 15, word: 'LEÓN', rhymeMatchId: 16, emoji: '🦁', color: '#a855f7' }, 
                { id: 16, word: 'CAMPEÓN', rhymeMatchId: 15, emoji: '🏆', color: '#be185d' }, 
            ],
            // Nivel 4
            [
                { id: 1, word: 'CASTILLO', rhymeMatchId: 2, emoji: '🏰', color: '#10b981' }, 
                { id: 2, word: 'BRILLO', rhymeMatchId: 1, emoji: '✨', color: '#fcd34d' }, 
                { id: 3, word: 'LLAVE', rhymeMatchId: 4, emoji: '🔑', color: '#6366f1' }, 
                { id: 4, word: 'AVE', rhymeMatchId: 3, emoji: '🐦', color: '#3b82f6' }, 
                { id: 5, word: 'DEDO', rhymeMatchId: 6, emoji: '👆', color: '#d946ef' }, 
                { id: 6, word: 'HUESO', rhymeMatchId: 5, emoji: '🦴', color: '#f59e0b' }, // Corrección: Dedo rima con Hueso (final 'o')
                { id: 7, word: 'OSO', rhymeMatchId: 8, emoji: '🐻', color: '#9d174d' }, 
                { id: 8, word: 'POZO', rhymeMatchId: 7, emoji: '🕳️', color: '#44403c' }, 
                { id: 9, word: 'MESA', rhymeMatchId: 10, emoji: '🍽️', color: '#525252' }, 
                { id: 10, word: 'CEREZA', rhymeMatchId: 9, emoji: '🍒', color: '#ef4444' }, 
                { id: 11, word: 'CIELO', rhymeMatchId: 12, emoji: '☁️', color: '#0ea5e9' }, 
                { id: 12, word: 'HIELO', rhymeMatchId: 11, emoji: '🧊', color: '#06b6d4' }, 
                { id: 13, word: 'SANDÍA', rhymeMatchId: 14, emoji: '🍉', color: '#dc2626' }, 
                { id: 14, word: 'DÍA', rhymeMatchId: 13, emoji: '🌅', color: '#fbbf24' }, 
                { id: 15, word: 'FALDA', rhymeMatchId: 16, emoji: ' skirt ', color: '#db2777' }, 
                { id: 16, word: 'ESPALDA', rhymeMatchId: 15, emoji: '🚶', color: '#a3e635' }, 
            ],
            // Nivel 5
            [
                { id: 1, word: 'ZAPATO', rhymeMatchId: 2, emoji: '👟', color: '#4f46e5' }, 
                { id: 2, word: 'BARATO', rhymeMatchId: 1, emoji: '🏷️', color: '#be123c' }, 
                { id: 3, word: 'ABETO', rhymeMatchId: 4, emoji: '🌲', color: '#065f46' }, 
                { id: 4, word: 'BOLETO', rhymeMatchId: 3, emoji: '🎫', color: '#10b981' }, 
                { id: 5, word: 'FOCA', rhymeMatchId: 6, emoji: ' seal ', color: '#0369a1' }, 
                { id: 6, word: 'BOCA', rhymeMatchId: 5, emoji: '👄', color: '#f43f5e' }, 
                { id: 7, word: 'FUENTE', rhymeMatchId: 8, emoji: '⛲', color: '#0891b2' }, 
                { id: 8, word: 'DIENTE', rhymeMatchId: 7, emoji: '🦷', color: '#d946ef' }, 
                { id: 9, word: 'GORRO', rhymeMatchId: 10, emoji: '🧢', color: '#f97316' }, 
                { id: 10, word: 'ZORRO', rhymeMatchId: 9, emoji: '🦊', color: '#b91c1c' }, 
                { id: 11, word: 'CEREBRO', rhymeMatchId: 12, emoji: '🧠', color: '#c026d3' }, 
                { id: 12, word: 'FEBRERO', rhymeMatchId: 11, emoji: '🗓️', color: '#a855f7' }, 
                { id: 13, word: 'MAR', rhymeMatchId: 14, emoji: '🌊', color: '#3b82f6' }, 
                { id: 14, word: 'SAL', rhymeMatchId: 13, emoji: '🧂', color: '#fcd34d' }, 
                { id: 15, word: 'VASO', rhymeMatchId: 16, emoji: '🥛', color: '#525252' }, 
                { id: 16, word: 'CASO', rhymeMatchId: 15, emoji: '🗃️', color: '#059669' }, 
            ]
        ];
        // -----------------------------------------------------------------


      let gameBoard = document.getElementById('game-board');
        let movesCountElement = document.getElementById('moves-count');
        let currentLevelElement = document.getElementById('current-level');
        let winMessage = document.getElementById('win-message');
        let finalMovesElement = document.getElementById('final-moves');
        let winTitle = document.getElementById('win-title');
        let winText = document.getElementById('win-text');
        let actionButton = document.getElementById('action-button');
        let winEmoji = document.getElementById('win-emoji');

        let currentLevel = 1;
        let allCards = [];
        let flippedCards = []; 
        let matchesFound = 0;
        let moves = 0;
        let lockBoard = false; 

        /**
         * Reinicia el juego volviendo al nivel 1.
         */
        function resetGame() {
            currentLevel = 1;
            startGame();
        }

        /**
         * Avanza al siguiente nivel.
         */
        function goToNextLevel() {
            winMessage.classList.add('hidden');
            currentLevel++;
            startGame();
        }

        /**
         * Inicializa y comienza un nuevo juego para el nivel actual.
         */
        function startGame() {
            // Asegurar que el nivel no exceda el máximo
            if (currentLevel > levelsCardData.length) {
                currentLevel = 1; // Volver al inicio si por alguna razón se pasó el límite
            }

            // Reiniciar variables de nivel
            allCards = [];
            flippedCards = [];
            matchesFound = 0;
            moves = 0;
            lockBoard = false;

            // Actualizar la interfaz de usuario
            movesCountElement.textContent = moves;
            currentLevelElement.textContent = currentLevel;
            winMessage.classList.add('hidden');
            gameBoard.innerHTML = ''; // Limpiar el tablero

            // Obtener las cartas para el nivel actual (usando currentLevel - 1 porque es un array 0-indexado)
            let gameCards = [...levelsCardData[currentLevel - 1]];

            // 2. Mezclar las cartas
            shuffle(gameCards);

            // 3. Renderizar las tarjetas en el DOM
            gameCards.forEach(card => {
                const cardElement = createCardElement(card);
                gameBoard.appendChild(cardElement);
                allCards.push(cardElement);
            });
        }

        /**
         * Función de mezcla Fisher-Yates (Shuffle)
         */
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * Crea el elemento HTML para una tarjeta
         * @param {Object} card - Objeto de datos de la tarjeta.
         * @returns {HTMLElement} El elemento contenedor de la tarjeta.
         */
        function createCardElement(card) {
            const cardContainer = document.createElement('div');
            cardContainer.className = 'card-container aspect-square'; // Asegura que sean cuadrados
            cardContainer.dataset.cardId = card.id; // ID propio
            cardContainer.dataset.matchId = card.rhymeMatchId; // ID de la pareja que rima
            cardContainer.onclick = () => handleCardClick(cardContainer);

            const cardInner = document.createElement('div');
            cardInner.className = 'card-inner';

            // Cara frontal (la imagen/emoji)
            const cardFront = document.createElement('div');
            cardFront.className = 'card-front';
            // Establecer el color de la tarjeta (para borde y texto)
            cardFront.style.setProperty('--card-color', card.color);

            const emoji = document.createElement('span');
            emoji.className = 'text-5xl md:text-6xl';
            emoji.textContent = card.emoji;

            const word = document.createElement('p');
            word.className = 'text-lg md:text-xl font-extrabold mt-1';
            word.textContent = card.word;

            cardFront.appendChild(emoji);
            cardFront.appendChild(word);

            // Cara trasera (el dorso del juego)
            const cardBack = document.createElement('div');
            cardBack.className = 'card-back';
            cardBack.textContent = 'RIMA';

            cardInner.appendChild(cardFront);
            cardInner.appendChild(cardBack);
            cardContainer.appendChild(cardInner);

            return cardContainer;
        }

        /**
         * Maneja el evento de clic en una tarjeta.
         * @param {HTMLElement} clickedCard - El elemento DOM de la tarjeta.
         */
        function handleCardClick(clickedCard) {
            // Ignorar clics si el tablero está bloqueado, la tarjeta ya está volteada o ya fue emparejada.
            if (lockBoard || clickedCard.classList.contains('flipped') || clickedCard.classList.contains('matched')) {
                return;
            }

            // 1. Voltear la tarjeta y agregarla a la lista de volteadas
            clickedCard.classList.add('flipped');
            flippedCards.push(clickedCard);

            // 2. Verificar si hay 2 cartas volteadas
            if (flippedCards.length === 2) {
                lockBoard = true;
                moves++;
                movesCountElement.textContent = moves;

                setTimeout(checkForMatch, 1000); // Esperar 1 segundo antes de verificar
            }
        }

        /**
         * Verifica si las dos cartas volteadas hacen rima.
         */
        function checkForMatch() {
            const [card1, card2] = flippedCards;

            // Obtener IDs de las cartas. Una tarjeta (card1) hace match si su matchId es igual al id de card2
            const card1MatchId = card1.dataset.matchId;
            const card2Id = card2.dataset.cardId;

            // Verifica si card1 debe hacer match con card2 (y vice versa, aunque solo necesitamos una verificación)
            const isMatch = (parseInt(card1MatchId) === parseInt(card2Id));

            if (isMatch) {
                // ¡Coincidencia! (MATCH)
                disableCards(card1, card2);
            } else {
                // No Coincidencia (MISMATCH)
                unflipCards(card1, card2);
            }

            // Limpiar la lista de volteadas
            flippedCards = [];
            lockBoard = false;
        }

        /**
         * Marca las cartas como emparejadas y permanentes.
         * @param {HTMLElement} card1
         * @param {HTMLElement} card2
         */
        function disableCards(card1, card2) {
            // Aplicar estilo de "coincidencia" y eliminar el evento de click (aunque ya está cubierto por la clase 'matched')
            card1.classList.add('matched', 'shadow-xl', 'ring-4', 'ring-brand-success/80');
            card2.classList.add('matched', 'shadow-xl', 'ring-4', 'ring-brand-success/80');

            matchesFound++;

            // FIX: Debe ser igual al número de PARES (total de cartas / 2), que es 8.
            const totalPairs = levelsCardData[currentLevel - 1].length / 2; 

            if (matchesFound === totalPairs) {
                endGame();
            }
        }

        /**
         * Voltea las cartas si no hay coincidencia.
         * @param {HTMLElement} card1
         * @param {HTMLElement} card2
         */
        function unflipCards(card1, card2) {
            // Agregar animación de error antes de voltear
            card1.classList.add('mismatch');
            card2.classList.add('mismatch');

            // Voltear después de la animación de error
            setTimeout(() => {
                card1.classList.remove('flipped', 'mismatch');
                card2.classList.remove('flipped', 'mismatch');
            }, 1000);
        }

        /**
         * Muestra el mensaje de victoria (nivel o juego completo).
         */
        function endGame() {
            finalMovesElement.textContent = moves;

            if (currentLevel < levelsCardData.length) {
                // Aún hay niveles por jugar
                winEmoji.textContent = '🌟';
                winTitle.textContent = `¡Nivel ${currentLevel} Superado!`;
                winText.innerHTML = `Has encontrado todas las rimas en <span class="font-extrabold text-yellow-600">${moves}</span> movimientos. ¿Listo para el siguiente?`;
                actionButton.textContent = 'Siguiente Nivel';
                actionButton.onclick = goToNextLevel;
            } else {
                // Juego completado
                winEmoji.textContent = '🎉';
                winTitle.textContent = '¡Juego de Rimas Completado!';
                winText.innerHTML = `¡Lo lograste! Has superado los 5 niveles.`;
                actionButton.textContent = 'Jugar de Nuevo';
                actionButton.onclick = resetGame;
            }

            winMessage.classList.remove('hidden');
        }

        // Iniciar el juego automáticamente al cargar la página
        window.onload = startGame;

    </script>
</body>
</html>
